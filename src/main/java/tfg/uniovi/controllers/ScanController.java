package tfg.uniovi.controllers;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.activiti.engine.RuntimeService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import tfg.uniovi.model.Vulnerability;
import tfg.uniovi.repository.ServerRepository;
import tfg.uniovi.repository.Vulnerabilities;
import tfg.uniovi.repository.VulnerabilityRepository;

@RestController
public class ScanController {
	
	@Autowired
	private VulnerabilityRepository vulnerabilities;
	
	@Autowired
	private ServerRepository serverRepository;
	
	@Autowired
	private RuntimeService runtimeService;
	
	@RequestMapping(value = "/wordpressScan")
	public ResponseEntity<List<Vulnerability>> wordpressScan() {
		Map<String, Object> variables = new HashMap<>();
		runtimeService.startProcessInstanceByKey("wordpressScan", variables);
		
		List<Vulnerability> vulns = Vulnerabilities.getInstance().getVulnerabilities();
		
		
		return new ResponseEntity<>(vulns, HttpStatus.OK);
	}
	
	public void init() {
		//knownVulnerabilities.save(new KnownVulnerability("CVE2018-1", "Wordpress", "3.0", "SQL Injection"));
	}
	
	public String outputCMS() {
		//KnownVulnerability cms = knownVulnerabilities.findByCms("Wordpress");
		//return cms.getName() + " - " + cms.getVersion();
		return "";
	}
	
}
